---
title: "Signal and Noise Subgroups"
author: "Andrew Zimolzak"
date: "2022-10-09"
output: html_document
runtime: shiny
---

When a variable has no effect in most groups, but has an effect in one group,
it can look like no effect in the whole population.

```{r libraries, include=FALSE}
library(ggplot2)
library(dplyr)
```

```{r functions, include=FALSE}
noisy_line <- function(slope, intercept, n, Subgroup) {
  
  n = n - 1
  
  data.frame(x = 0:n / n * 10, eps = rnorm(n + 1, 0, 1)) %>%
    mutate(y = slope * x + intercept + eps,
           Subgroup = Subgroup) -> df
  
  return(df)
  
}
```

```{r three-populations, include=FALSE}


```






## Settings

Choose how you want your populations to look

```{r eruptions, echo=FALSE}
inputPanel(

  sliderInput("nlow", label = "N of low-risk:",
              min = 50, max = 200, value = 100, step = 1),
  
  sliderInput("nmed", label = "N of medium-risk:",
              min = 50, max = 200, value = 100, step = 1),
  
  sliderInput("nhi", label = "N of high-risk:",
              min = 10, max = 40, value = 20, step = 1)

)


make_rand_plot <- function() {

grp1 <- noisy_line(0, 3.5, input$nlow, 'Low risk')
grp2 <- noisy_line(0, 6.5, input$nmed, 'Medium risk')
grp3 <- noisy_line(1, 0, input$nhi, 'High risk')

df <- rbind(grp1, grp2, grp3)

bad_lm <- lm(df$y ~ df$x)

myplot <- ggplot(df, aes(x=x, y=y)) +
  geom_point() +
  geom_abline(slope = bad_lm$coefficients[2], intercept = bad_lm$coefficients[1])

return(myplot)

}


renderPlot({
  make_rand_plot()
})
```


